%{!?release: %define release 0}
%{!?epoch:   %define epoch 0}
%{!?version: %define version @VERSION@}

%{!?uses_stdcpp:  %define uses_stdcpp 1}
%{!?uses_openssl: %define uses_openssl 1}
%{!?uses_gcrypt:  %define uses_gcrypt 0}

%if %uses_openssl
	%define	_depend_requires openssl
	%define	_build_requires gcc-c++ openssl-devel
	%define	_config_crypto --with-crypto=openssl
%else
%if %uses_gcrypt
	%define	_depend_requires libgcrypt
	%define	_build_requires gcc-c++ libgcrypt-devel
	%define _config_crypto --with-crypto=gcrypt
%else
	%define	_build_requires gcc-c++
	%define _config_crypto --with-crypto=none
%endif
%endif

%if ! %uses_stdcpp
	%define	_config_stdcpp --disable-stdcpp
%endif

Name: ucommon
Summary: "ucommon" - portable embedded runtime
Version: %{version}
Release: %{release}%{?dist}
Epoch: %{epoch}
License: LGPL
Group: Development/Libraries
Source0: ucommon-%{PACKAGE_VERSION}.tar.gz
BuildRoot: %{_tmppath}/%{name}-%{version}-%{release}-root
BuildRequires: %{_build_requires}
%if %{uses_gcrypt} || %{uses_openssl}
Requires: %{_depend_requires}
%endif

%package devel
Requires: ucommon = %{epoch}:%{version}-%{release}
Group: Development/Libraries
Summary: Headers and static link library for ucommon

%description

%description devel

%prep
%setup
%build

%configure %{?_config_stdcpp} %{_config_crypto} CXXFLAGS="$RPM_OPT_FLAGS" %{?_build_environ_}
make %{?_smp_mflags} LDFLAGS="-s"

%install

%makeinstall
rm -rf %{buildroot}/%{_infodir}

%clean
rm -fr %{buildroot}

%files 
%defattr(-,root,root,-)
%doc README COPYING INSTALL NEWS BUILDS
%{_libdir}/*.so.*

%files devel
%defattr(-,root,root,-)
%{_bindir}/ucommon-config
%{_libdir}/*.a
%{_libdir}/*.so
%{_libdir}/*.la
%dir %{_includedir}/ucommon
%{_includedir}/ucommon/*.h
%{_libdir}/pkgconfig/*.pc

%post -p /sbin/ldconfig

%postun -p /sbin/ldconfig

