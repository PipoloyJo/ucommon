%{!?release: %define release 0}
%{!?epoch:   %define epoch 0}
%{!?version: %define version @VERSION@}

%{!?uses_stdcpp:  %define uses_stdcpp 1}

%if %uses_stdcpp
%define _devel_requires libstdc++-devel
%else
%define	_config_stdcpp --disable-stdcpp
%endif

Name: ucommon
Summary: "ucommon" - portable embedded runtime
Version: %{version}
Release: %{release}%{?dist}
Epoch: %{epoch}
License: GPL
URL http://www.gnu.org/software/commoncpp
Group: Development/Libraries
Source0: http://www.gnutelephony.org/dist/tarballs/ucommon-%{version}.tar.gz
BuildRoot: %{_tmppath}/%{name}-%{version}-%{release}-root
BuildRequires: gcc-c++ %{?_devel_requires}

%package devel
Requires: ucommon = %{epoch}:%{version}-%{release}, %{?_devel_requires}
Group: Development/Libraries
Summary: Headers and static link library for ucommon

%description

%description devel

%prep
%setup
%build

%configure %{?_config_stdcpp} CXXFLAGS="$RPM_OPT_FLAGS" 
make %{?_smp_mflags} LDFLAGS="-s"

%install

%makeinstall
rm -rf %{buildroot}/%{_infodir}

%clean
rm -fr %{buildroot}

%files 
%defattr(-,root,root,-)
%doc README COPYING INSTALL NEWS BUILDS
%{_libdir}/*.so.*

%files devel
%defattr(-,root,root,-)
%{_bindir}/ucommon-config
%{_libdir}/*.a
%{_libdir}/*.so
%{_libdir}/*.la
%dir %{_includedir}/ucommon
%{_includedir}/ucommon/*.h
%{_libdir}/pkgconfig/*.pc

%post -p /sbin/ldconfig

%postun -p /sbin/ldconfig

