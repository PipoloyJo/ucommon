%{!?release: %define release 0}
%{!?epoch:   %define epoch 0}
%{!?version: %define version @VERSION@}

%{!?uses_stdcpp:  %define uses_stdcpp 1}

%if %uses_stdcpp
%define _devel_requires libstdc++-devel
%else
%define	_config_stdcpp --disable-stdcpp
%endif

Name: ucommon
Summary: "ucommon" - portable embedded runtime
Version: %{version}
Release: %{release}%{?dist}
Epoch: %{epoch}
License: GPL
URL: http://www.gnu.org/software/commoncpp
Group: Development/Libraries
Source0: http://www.gnutelephony.org/dist/tarballs/ucommon-%{version}.tar.gz
BuildRoot: %{_tmppath}/%{name}-%{version}-%{release}-root
BuildRequires: gcc-c++ %{?_devel_requires}

%package devel
%if %uses_stdcpp
Requires: %{?_devel_requires}
%endif
Requires: ucommon = %{epoch}:%{version}-%{release}
Group: Development/Libraries
Summary: Headers and static link library

%package doc
Group: Documentation
Summary: Generated class documentation for ucommon

%description
uCommon is a lightweight C++ library to facilitate using C++ design patterns
even for very deeply embedded applications, such as for systems using uClibc
along with POSIX threading support. For this reason, UCommon disables language
features that consume memory or introduce runtime overhead. UCommon introduces
some design patterns from Objective-C, such as reference counted objects,
memory pools, and smart pointers. UCommon introduces some new concepts for
handling of thread locking and synchronization.

%description devel
Static link and header files for building applications that use uCommon.

%description doc
Generated class documentation for GNU uCommon library from header files, 
html browsable.

%changelog

%prep
%setup
%build

%configure %{?_config_stdcpp} -CXXFLAGS="$RPM_OPT_FLAGS" 
%{__make} %{?_smp_mflags} 
%{__make} doxy

%install

%makeinstall
%{__strip} %{buildroot}/%{_libdir}/libucommon-*.so.*.*

%clean
%{__rm} -fr %{buildroot}

%files 
%defattr(-,root,root,-)
%doc AUTHORS README COPYING INSTALL NEWS BUILDS SUPPORT ChangeLog
%{_libdir}/*.so.*

%files devel
%defattr(-,root,root,-)
%{_libdir}/*.a
%{_libdir}/*.so
%{_libdir}/*.la
%dir %{_includedir}/ucommon
%{_includedir}/ucommon/*.h
%{_libdir}/pkgconfig/*.pc
%attr(0755,root,root) %{_bindir}/ucommon-config

%files doc
%doc doc/html/*

%post -p /sbin/ldconfig

%postun -p /sbin/ldconfig

